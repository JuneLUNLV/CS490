<html class="myhtml">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title>UNLV Faculty Mentoring Information Look Up</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
	<style>
	.dropdown-content {
		top: 100% !important;
	}

	.myhtml {
		font-family: 'Ubuntu', sans-serif;
		font-size: 100%;
		background: #333;
		-webkit-font-smoothing: antialiased;
		height: 100%;
	}

	#page-wrapper {
		width: 90%;
		background: #FFFFFF;
		padding: 1em;
		margin: 1em auto;
		border-top: 8px solid #785ad4;
		box-shadow: 0 10px 10px rgba(0, 0, 0, 0.8);
		margin-top: 7%;
		border-radius: 5px;
		padding-left: 30px;
		position: relative;
	}

	.myh1 {
		margin-top: 0;
		font-size: 2vw;
	}

	.myp {
		font-size: 25px;
		padding-top: 7px;
	}

	.contentWrapper {
		display: inline-flex;
		width: 100%
	}

	.flexdatalist_border {
		border-bottom: 1px solid black !important;
	}

	.studentNameGroupOfFiveDiv {
		display: inline-flex;
		flex-direction: row;
		margin-bottom: 10px;
	}

	#showOrHideListGroupId {
		cursor: pointer;
		text-decoration: underline;
		font-size: 20px;
		margin-left: 30px;
		margin-bottom: 5px;
		user-select: none;
	}

	.my_close {
		position: absolute;
		top: 0.5rem;
		right: 0.5rem;
		display: flex;
		align-items: center;
		justify-content: center;
		width: 2.5rem;
		height: 2.5rem;
		border: none;
		background-color: transparent;
		font-size: 1.5rem;
		transition: 0.35s linear;
		cursor: pointer;
	}

	.my_restore {
		position: absolute;
		top: 0.5rem;
		right: 0.5rem;
		display: flex;
		align-items: center;
		justify-content: center;
		width: 2.5rem;
		height: 2.5rem;
		border: none;
		background-color: transparent;
		font-size: 1.5rem;
		transition: 0.35s linear;
		cursor: pointer;
	}

	.my_restore:hover {
		transform: rotate(-180deg);
    color: #13ff83e6;
	}

	.restoreButton {
		line-height: 3.1rem;
		font-size: 2.3rem;
	}

	.my_close:before,
	.my_close:after {
		position: absolute;
		content: '';
		width: 1.25rem;
		height: 0.125rem;
		background-color: black;
	}

	.my_close:before {
		transform: rotate(-45deg);
	}

	.my_close:after {
		transform: rotate(45deg);
	}

	.my_close:hover {
		transform: rotate(360deg);
	}

	.my_close:hover:before,
	.my_close:hover:after {
		background-color: tomato;
	}

	.my_close:focus {
		background-color: transparent;
		outline: none;
	}

	.empty-list-group-item {
		visibility: hidden;
	}
	</style>
</head>

<body>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
	<script src="http://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
	<link rel="stylesheet" type="text/css" href="{{url_for('static',filename='jquery.flexdatalist.min.css') }}">
	<script type="text/javascript" src="http://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
	<script src="{{url_for('static', filename='jquery.flexdatalist.min.js')}}"></script>
	<script src="{{url_for('static', filename='table2CSV.js')}}"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
	<ul id="dropdown1" class="dropdown-content">
		<li class="divider"></li>
		<li><a href="#!">Log Out</a></li>
	</ul>
	<nav>
		<div class="nav-wrapper" style="background-color: #2b97d6;">
			<a onclick='window.location.href = "/"' style="margin-left: 20px;margin-right: 40px;position:relative" class="brand-logo left">HOME</a>
			<ul id="nav-mobile" class="left hide-on-med-and-down">
				<li><a onclick='window.location.href = "/main_menu"'>Individual Assign</a></li>
				<li><a style="background-color: rgba(0,0,0,0.19);">Mass Assign</a></li>
				<li><a onclick='window.location.href = "/mentoring_joined?username=&email="'>Table</a></li>
				<li><a onclick='window.location.href = "/backup_database"'>Backup Database</a></li>
				<li><a style="position: absolute;right: 0px; margin-right: 20px;" class="dropdown-trigger" href="#!" data-target="dropdown1">John<i class="material-icons right">arrow_drop_down</i></a></li>
			</ul>
		</div>
	</nav>
	<div id="page-wrapper">
		<div class="contentWrapper">
			<p class="myp">Assign <span class="studentCount">0</span> students from professor</p>
			<input type='text' placeholder='Name' class='flexdatalist first-flexdatalist' data-search-in='professorName' data-visible-properties='["professorName"]' data-selection-required='true' data-value-property='id' data-text-property='{professorName}' data-min-length='0' name='mentor_name_input_1'>
			<p class="myp">To prefessor</p>
			<input type='text' placeholder='Name' class='flexdatalist second-flexdatalist' data-search-in='professorName' data-visible-properties='["professorName"]' data-selection-required='true' data-value-property='id' data-text-property='{professorName}' data-min-length='0' name='mentor_name_input_2'>
		</div>
		<p class="myp" id="showOrHideListGroupId" onclick="showOrHideListGroupFunction()">show all <span class="studentCount">0</span> students</p>
		<div class="list-group" style="opacity: 0;display: none;width: 95%; flex-direction: row;border: 2px solid #6c87d3b3;padding-top: 15px;border-radius: 0.3125rem;padding-left: 50px;margin-top: 0px;margin-bottom: 30px;margin-left: 1.5%;transition: opacity 2s ease-out 1s;">
			<!----       <div class="studentNameGroupOfFiveDiv">
          <a href="#" class="list-group-item list-group-item-action">Student, Name 1<i class="small material-icons my_restore">replay</i></a>
          <a href="#" class="list-group-item list-group-item-action empty-list-group-item">Student, Name 2</a>
          <a href="#" class="list-group-item list-group-item-action empty-list-group-item">Student, Name 3</a>
          <a href="#" class="list-group-item list-group-item-action empty-list-group-item">Student, Name 4</a>
          <a href="#" class="list-group-item list-group-item-action empty-list-group-item">Student, Name 5</a>
          </div>
        <div class="studentNameGroupOfFiveDiv">          
          <a href="#" class="list-group-item list-group-item-action">Student, Name 6</a>
          <a href="#" class="list-group-item list-group-item-action">Student, Name 7</a>
          <a href="#" class="list-group-item list-group-item-action">Student, Name 8</a>
          <a href="#" class="list-group-item list-group-item-action">Student, Name 9</a>
          <a href="#" class="list-group-item list-group-item-action">Student, Name 10</a>
          </div>
          <div class="studentNameGroupOfFiveDiv">     
          <a href="#" class="list-group-item list-group-item-action">Student, Name 6</a>
          <a href="#" class="list-group-item list-group-item-action">Student, Name 7</a>
          <a href="#" class="list-group-item list-group-item-action empty-list-group-item">Student, Name 8</a>
          <a href="#" class="list-group-item list-group-item-action empty-list-group-item">Student, Name 9</a>
          <a href="#" class="list-group-item list-group-item-action empty-list-group-item">Student, Name 10</a>    
          </div>        
     </div> --->
		</div>
</body>
  <script>
    let jsonData = decodeHtml('{{professorJson}}');
    let jsonData2 = decodeHtml('{{studentForProfessorsJson}}');
    let studentAndProfessorJsonDict = JSON.parse(jsonData2);
    let professorJsonDict = JSON.parse(jsonData);
    let activeStudent = 0;
    let originalMarginTop = marginTop = parseInt($('#page-wrapper').css('marginTop'));
    let itemPerRow = 4;
    $('.flexdatalist.first-flexdatalist').flexdatalist({
      minLength: 1,
      valueProperty: 'professorName',
      selectionRequired: true,
      visibleProperties: ["professorName"],
      searchIn: 'professorName',
      data: JSON.parse(jsonData)
    });
    $('.flexdatalist.second-flexdatalist').flexdatalist({
      minLength: 1,
      valueProperty: 'professorName',
      selectionRequired: true,
      visibleProperties: ["professorName"],
      searchIn: 'professorName',
      data: JSON.parse(jsonData)
    });
    let originalDataArray = $('input.flexdatalist.second-flexdatalist').data().flexdatalist.data.slice(0);
    //nav bar drop down
    $(".dropdown-trigger").dropdown({
      belowOrigin: true
    });

    function decodeHtml(str) {
      return str.replace(/&#(\d+);/g, function(match, dec) {
        return String.fromCharCode(dec);
      });
    }
    $('input.flexdatalist-alias').css("border-color", "black")
    $('input.flexdatalist-alias').css("width", "7%")
    $('input.flexdatalist-alias').css("margin-right", "7px")
    $('input.flexdatalist-alias').css("border-right", "0px")
    $('input.flexdatalist-alias').css("outline", "none")
    $('input.flexdatalist-alias').css("margin-left", "20px")
    $('input.flexdatalist-alias').css("font-size", "25px")
    $('input.flexdatalist-alias')[0].classList.toggle('flexdatalist_border');
    /*    function inputOnclick(){
          input = $('input.flexdatalist-alias.flex0')[0]
          input.value = ""
          var e = jQuery.Event("keyup");
          e.which = 40; // it is down
          $("input.flexdatalist-alias.flex0").trigger(e);
        }*/
    for(var i = 0; i < $('input.flexdatalist-alias').length; i++) {
      $('input.flexdatalist-alias')[i].onclick = function inputOnclick() {
        this.value = ""
        var e = jQuery.Event("keyup");
        e.which = 40; // it is down
        $(this).trigger(e);
      }
    }
    $('input.flexdatalist').on('change:flexdatalist', function(event, set, options) {
      $('input.flexdatalist').data().flexdatalist.data = originalDataArray.slice(0);
      if(this.name == "mentor_name_input_1") {
        var val = set.text;
        studentCountElementArray = document.getElementsByClassName("studentCount")
        if(val.length == 0) {
          for(var j = 0; j < studentCountElementArray.length; j++) studentCountElementArray[j].textContent = "0";
          activeStudent = 0;
          clearListGroup();
          return;
        }
        for(var i = 0; i < professorJsonDict.length; i++) {
          if(val == professorJsonDict[i].professorName) {
            for(var j = 0; j < studentCountElementArray.length; j++) studentCountElementArray[j].textContent = professorJsonDict[i].count;
            activeStudent = professorJsonDict[i].count;
          }
        }
        var professorId;
        for(professorId = 0; professorId < studentAndProfessorJsonDict.length; professorId++) {
          if(studentAndProfessorJsonDict[professorId].professorName == val) break;
        }
        for(var studentIndex = 0; studentIndex < studentAndProfessorJsonDict[professorId].nameAndIdDictArr.length; studentIndex++) {
          var currentRow;
          if(studentIndex % itemPerRow == 0) {
            currentRow = createGroupListItemRow()
          }
          let child1 = currentRow.children[studentIndex % itemPerRow].childNodes[0]
          let child2 = currentRow.children[studentIndex % itemPerRow].childNodes[1]
          currentRow.children[studentIndex % itemPerRow].textContent = studentAndProfessorJsonDict[professorId].nameAndIdDictArr[studentIndex].studentName;
          currentRow.children[studentIndex % itemPerRow].classList.remove('empty-list-group-item');
          currentRow.children[studentIndex % itemPerRow].appendChild(child1)
          currentRow.children[studentIndex % itemPerRow].appendChild(child2)
          currentRow.children[studentIndex % itemPerRow].setAttribute('data-relationship-id', studentAndProfessorJsonDict[professorId].nameAndIdDictArr[studentIndex].relationshipId);
        }
        //$('input.flexdatalist').data().flexdatalist.data;
        for(var i = 0; i < $('input.flexdatalist.second-flexdatalist').data().flexdatalist.data.length; i++) {
          if($('input.flexdatalist.second-flexdatalist').data().flexdatalist.data[i].professorName.includes(val)) $('input.flexdatalist.second-flexdatalist').data().flexdatalist.data.splice(i, 1);
        }
        hideListGroup();
        repositionPageWrapper();
      }
    });

    function showOrHideListGroupFunction() {
      if($('.list-group').css('opacity') == "0") {
        showListGroup();
      } else {
        hideListGroup();
      }
      repositionPageWrapper();
    }

    function repositionPageWrapper() {
      let offset = $('nav')[0].offsetHeight + $('#page-wrapper')[0].offsetHeight + parseInt($('#page-wrapper').css('marginTop')) - parseInt($('body')[0].offsetHeight * 0.89)
      marginTop = parseInt($('#page-wrapper').css('marginTop'));
      if(offset > 0) {
        if(marginTop - offset > 0)
          $('#page-wrapper').css('marginTop', marginTop - offset)
        else
          $('#page-wrapper').css('marginTop', "5px")
      }
      else $('#page-wrapper').css('marginTop', originalMarginTop)
    }

    function hideListGroup() {
      $('.list-group').css('opacity', '0');
      $('.list-group').css('display', 'none');
    }

    function showListGroup() {
      if(activeStudent == 0) return;
      $('.list-group').css('opacity', '1');
      $('.list-group').css('display', 'grid');
    }

    function clearListGroup() {
      const myNode = document.getElementsByClassName('list-group')[0]
      while(myNode.lastElementChild) {
        myNode.removeChild(myNode.lastElementChild);
      }
    }
    $('.list-group-item.list-group-item-action').css('border-radius', '10px');
    $('.list-group-item.list-group-item-action').css('margin-right', '50px');
    $('.list-group-item.list-group-item-action').css('cursor', 'default');
    $('.list-group-item.list-group-item-action').css('padding-left', '35px');

    function createGroupListItemRow() {
      let listItemGroupDiv = document.createElement('div')
      listItemGroupDiv.setAttribute('class', 'studentNameGroupOfFiveDiv')
      for(var i = 0; i < itemPerRow; i++) {
        let listGroupItem = document.createElement('a')
        listGroupItem.setAttribute('class', 'list-group-item')
        listGroupItem.classList.add('list-group-item-action')
        listGroupItem.style.height = '51px';
        listGroupItem.style.borderRadius = "10px";
        listGroupItem.style.marginRight = "50px";
        listGroupItem.style.cursor = "default";
        listGroupItem.style.paddingLeft = "20px";
        listGroupItem.style.fontSize = "0.8vw";
        listGroupItem.classList.add('empty-list-group-item')
        listGroupItem.setAttribute('data-relationship-id', "0")
        listGroupItem.setAttribute('data-active', 'true');
        let closeButton = document.createElement('button');
        closeButton.setAttribute('class', 'my_close');
        closeButton.onclick = function disbaleStudentListGroupItem() {
          listGroupItem.style.cursor = 'not-allowed';
          listGroupItem.style.backgroundColor = '#919191c2';
          listGroupItem.style.color = 'white';
          closeButton.style.visibility = "hidden"
          activeStudent = activeStudent - 1;
          document.getElementsByClassName("studentCount")[0].textContent = activeStudent;
          listGroupItem.setAttribute('data-active', 'false');
          setTimeout(function() {
            restoreButton.style.visibility = "visible"
          }, 400);
        }
        let restoreButton = document.createElement('i');
        restoreButton.setAttribute('class', 'small');
        restoreButton.classList.add('material-icons');
        restoreButton.classList.add('my_restore');
        restoreButton.textContent = "replay";
        restoreButton.style.visibility = "hidden"
        restoreButton.onclick = function ableStudentListGroupItem() {
          listGroupItem.style.cursor = 'default';
          listGroupItem.style.backgroundColor = 'white';
          listGroupItem.style.color = 'black';
          restoreButton.style.visibility = "hidden"
          activeStudent = activeStudent + 1;
          document.getElementsByClassName("studentCount")[0].textContent = activeStudent;
          listGroupItem.setAttribute('data-active', 'true');
          setTimeout(function() {
            closeButton.style.visibility = "visible";
          }, 400);
        }
        listGroupItem.appendChild(closeButton);
        listGroupItem.appendChild(restoreButton);
        listItemGroupDiv.appendChild(listGroupItem);
      }
      $('.list-group')[0].appendChild(listItemGroupDiv);
      return listItemGroupDiv;
    }
    /* $('#page-wrapper').bind("DOMSubtreeModified",function(){
        repositionPageWrapper();
      });
    */
  </script>

</html>